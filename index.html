<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <title>æé€Ÿæ‹ç«‹å¾— Pro</title>
    <link rel="apple-touch-icon" href="icon.png"> <!-- è®°å¾—ç¡®ä¿ä½ çš„å›¾æ ‡è¿˜åœ¨ -->
    <style>
        :root {
            --cam-width: 240px;
            --cam-height: 220px;
            --paper-width: 180px;
            --paper-height: 216px;
        }

        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            background-color: #1a1a1a;
            /* ç§‘æŠ€æ„Ÿç½‘æ ¼èƒŒæ™¯ */
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            overflow: hidden;
            font-family: -apple-system, sans-serif;
            -webkit-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }

        #photo-wall {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
            touch-action: none;
        }

        .camera-container {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            width: var(--cam-width);
            height: var(--cam-height);
            z-index: 100;
        }

        .camera-body {
            width: 100%;
            height: 100%;
            background: #e0e0e0;
            border-radius: 24px;
            box-shadow: 
                0 20px 50px rgba(0,0,0,0.6),
                inset 0 2px 5px rgba(255,255,255,0.9);
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 102;
        }

        .stripe {
            width: 100%;
            height: 12px;
            background: linear-gradient(to right, #ff3b30, #ff9500, #ffcc00, #4cd964, #5ac8fa, #007aff);
            margin-top: 35px;
        }

        .lens-area {
            width: 124px;
            height: 124px;
            background: #000;
            border-radius: 50%;
            margin-top: 15px;
            border: 3px solid #ccc;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            overflow: hidden;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        video#camera-feed {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            /* âœ¨ ç¾é¢œæ»¤é•œï¼šç¾ç™½+ç£¨çš®æ•ˆæœ */
            filter: brightness(1.15) contrast(0.95) saturate(1.1);
        }

        /* çº¢è‰²å¿«é—¨æŒ‰é’® */
        .shutter-btn {
            position: absolute;
            right: 18px;
            top: 75px;
            width: 54px;
            height: 54px;
            background: #ff3b30;
            border-radius: 50%;
            border: 4px solid #d1d1d6;
            touch-action: manipulation;
            box-shadow: 0 4px 0 #b0261e;
            transition: transform 0.05s, box-shadow 0.05s;
            z-index: 103;
        }

        .shutter-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #b0261e;
        }

        .slot {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 190px;
            height: 14px;
            background: #000;
            border-radius: 8px;
            z-index: 101;
        }

        .polaroid {
            position: absolute;
            width: var(--paper-width);
            height: var(--paper-height);
            background: #fff;
            padding: 12px 12px 50px 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.25);
            box-sizing: border-box;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            touch-action: none;
            will-change: transform;
        }

        .polaroid-img {
            width: 100%;
            height: 156px;
            background: #222;
            overflow: hidden;
        }

        .polaroid-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delete-btn {
            position: absolute;
            top: -12px;
            right: -12px;
            width: 28px;
            height: 28px;
            background: #ff3b30;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 26px;
            font-size: 20px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
            cursor: pointer;
            z-index: 1001;
            display: none;
            border: 2px solid #fff;
        }
        
        /* ğŸš€ æé€Ÿæ˜¾å½±åŠ¨ç”» (1.5ç§’å®Œæˆ) */
        @keyframes develop {
            0% { filter: brightness(5) blur(10px) grayscale(100%); opacity: 0.5; }
            40% { filter: brightness(1.5) blur(2px) sepia(50%); opacity: 0.9; }
            100% { filter: none; opacity: 1; }
        }

        .developing {
            animation: develop 1.5s ease-out forwards;
        }

        .hint-text {
            position: absolute;
            width: 100%;
            top: 15%;
            text-align: center;
            color: rgba(255,255,255,0.4);
            font-size: 14px;
            pointer-events: none;
            letter-spacing: 1px;
        }
    </style>
</head>
<body>

    <div id="photo-wall">
        <div class="hint-text">READY TO SHOOT</div>
    </div>

    <div class="camera-container">
        <div class="slot"></div>
        <div id="eject-layer" style="position: absolute; top: 0; left: 30px; width: 180px; height: 10px; z-index: 90;"></div>

        <div class="camera-body">
            <div class="stripe"></div>
            <div class="lens-area">
                <video id="camera-feed" autoplay playsinline webkit-playsinline muted></video>
            </div>
            <button class="shutter-btn" id="shutter"></button>
        </div>
    </div>

    <canvas id="capture-canvas" style="display: none;"></canvas>

    <script>
        const video = document.getElementById('camera-feed');
        const canvas = document.getElementById('capture-canvas');
        const shutterBtn = document.getElementById('shutter');
        const ejectLayer = document.getElementById('eject-layer');
        const photoWall = document.getElementById('photo-wall');

        // --- 1. æ‹ŸçœŸéŸ³æ•ˆå¼•æ“ (Web Audio API) ---
        // è¿™é‡Œæ¨¡æ‹ŸçœŸå®çš„æœºæ¢°å¿«é—¨â€œå’”åš“â€å£°ï¼Œè€Œä¸æ˜¯ç”µå­æ»´å£°
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        // åˆ›å»ºç™½å™ªéŸ³ buffer (ç”¨äºæ¨¡æ‹Ÿæœºæ¢°æ’å‡»/å¿«é—¨å£°)
        function createNoiseBuffer() {
            const bufferSize = audioCtx.sampleRate * 2; // 2ç§’ç¼“å†²åŒº
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                data[i] = Math.random() * 2 - 1;
            }
            return buffer;
        }
        const noiseBuffer = createNoiseBuffer();

        function playShutterSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const t = audioCtx.currentTime;

            // å£°éŸ³1ï¼šé«˜é¢‘â€œå’”â€ (å¿«é—¨å¼€å¯)
            const noise1 = audioCtx.createBufferSource();
            noise1.buffer = noiseBuffer;
            const filter1 = audioCtx.createBiquadFilter();
            filter1.type = 'highpass';
            filter1.frequency.value = 1000;
            const gain1 = audioCtx.createGain();
            gain1.gain.setValueAtTime(0.8, t);
